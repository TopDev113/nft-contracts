<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />

    <!-- Pako.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>

    <script id="hash-snippet">
        (() => {
            let dna = new URLSearchParams(window.location.search).get("dna");

            if (!dna) {
                // example: 0xde4b0d963091d3b0a9c9604784c0d9df49e4261df639643cc07185e78bb930ab
                // random 64 chars of abcd...1234 in hex
                dna =
                    "0x" +
                    Array(64)
                    .fill(0)
                    .map((_) => "0123456789abcdef" [(Math.random() * 16) | 0])
                    .join("");
            }
            window.dna = dna;

            const Artgene = {}; // namespace

            // shuffling images, seed from DNA string
            // https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript

            function xmur3(str) {
                for (var i = 0, h = 1779033703 ^ str.length; i < str.length; i++) {
                    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
                    h = (h << 13) | (h >>> 19);
                }
                return function () {
                    h = Math.imul(h ^ (h >>> 16), 2246822507);
                    h = Math.imul(h ^ (h >>> 13), 3266489909);
                    return (h ^= h >>> 16) >>> 0;
                };
            }

            function sfc32(a, b, c, d) {
                return function () {
                    a |= 0;
                    b |= 0;
                    c |= 0;
                    d |= 0;
                    var t = (((a + b) | 0) + d) | 0;
                    d = (d + 1) | 0;
                    a = b ^ (b >>> 9);
                    b = (c + (c << 3)) | 0;
                    c = (c << 21) | (c >>> 11);
                    c = (c + t) | 0;
                    return (t >>> 0) / 4294967296;
                };
            }

            const hash = xmur3(dna);

            console.log("USING DNA:", dna, ", HASH:", hash());

            // Pad seed with Phi, Pi and E.
            // https://en.wikipedia.org/wiki/Nothing-up-my-sleeve_number
            const _rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, hash());

            window.rendered = false;
            const preview = () => {
                console.log("TRIGGER PREVIEW");
                window.rendered = true;
            };

            // rand(a) should return [0,a]; rand(a,b) should return [a,b]
            window.rand = (a, b) => {
                if (a === undefined) {
                    return _rand();
                } else if (b === undefined) {
                    return _rand() * a;
                } else {
                    return _rand() * (b - a) + a;
                }
            };

            window.preview = preview;

            // for compatibility
            window.fxrand = rand;
            window.fxpreview = preview;

            window.genome = [];

            const evolve = (name, value) => {
                const genome = window.genome;
                const gene = genome.find((g) => g.name === name);

                if (!gene) {
                    genome.push({
                        name,
                        value
                    });
                } else {
                    gene.value = value;
                }

                return {
                    name,
                    value
                };
            };

            Artgene.evolve = evolve;
            Artgene.rand = rand;
            Artgene.preview = preview;
            Artgene.genome = window.genome;

            window.Artgene = Artgene;
        })(window);
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>

    <script type="text/javascript+gzip" src="data:text/javascript;base64,eJzFU8FSwjAQvfcr9higQkgdRqdykQsHOTGj59imtENNmDRAq8O/u0mqrQ46cvJAE7Zv377dtw1KYSCVPA6CbC8TUygJlTD7HRnAWwCQaMGNWHB54BWZURoCPgYxvnnmyXaj1V6mJPKRRJVKr1QqyHJ9H0I0Q/SU9h4OVRmttuJJFJvckMiFpHpQCivaO2qBOay4ycdZqZQmWa051hjA0FK0JFIVlVgLkRLEY+TUk59qfmzV2+YqI3bIyGjcBnyuj9IxjbB1gMkEHoU2RcJLKAspKoxlSgOxGbVFxnjcwbFITW6vo7lj9nU8cTNFXE8uyV2TMGqRV+6MOzxDvMd0wdqSID30G3c9TIBZDtL+uR70ktgFSS4Ly2AHbhQE78NuKiFkmr+IBTpr+nFLyShyTakvjEU7CnYxxaf4BLW71emLd8tzg79b2vbp94YkH22jSag8xKmHKAVP5t6cWjeXShevSppzfjbezwb9bMeP9zOG1t8Nde7/6KdzwS/I151oLrTTLcZfk1xW07Pz/OztoH61s2F/oGD/YmdW77Q4FOJI/KcevANMH0pI">

    </script>

    <!-- JavaScript file for decoding and decompression -->
    <script id="decoder">
        // decoder.js

        // Decoding and decompression function
        function decodeAndExecuteScript(base64EncodedGzipCompressedContent) {
            // Iterate through the base64-encoded, gzip-compressed JavaScript files
            //   for (let key in jsFiles) {
            // Get the base64-encoded, gzip-compressed content
            // const encodedContent = jsFiles[key];

            const arr = atob(base64EncodedGzipCompressedContent);

            console.log("ARR", arr);

            const buffer = Uint8Array.from(
                arr,
                (s) => s.charCodeAt(0)
            );

            // Decode the base64 content
            // const decodedContent = atob(encodedContent);

            console.log("DECODED", buffer);

            const text = pako.inflate(buffer);
            console.log("TEXT", text);

            const decoded = new TextDecoder("utf-8").decode(
                text
            );

            console.log("DECODED", decoded);

            // // Decompress the content using pako.js (a JavaScript zlib implementation)
            // const decompressedContent = pako.inflate(buffer, {
            //   to: "string",
            // });

            // Create a <script> element and append it to the document's head
            const script = document.createElement("script");
            script.textContent = decoded;
            document.head.appendChild(script);
        }
        // }

        // read all scripts gzip type and decode them
        const scripts = document.querySelectorAll("script[type='text/javascript+gzip']");
        scripts.forEach((script) => {
            // src is data:text/javascript;base64,xxxxxxxxxxxxxxxxxxxx, extract the base64-encoded, gzip-compressed content
            const base64EncodedGzipCompressedContent = script.src.split(",")[1];
            decodeAndExecuteScript(base64EncodedGzipCompressedContent);
        });

    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>artgene.xyz</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
        }

        main {
            background-color: #dedede;
            width: 100vw;
            height: 100vh;
            display: flex;
        }

        canvas {
            display: block;
            margin: auto;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>

<body>
    <main></main>

    <!-- Your HTML content -->
</body>

</html>