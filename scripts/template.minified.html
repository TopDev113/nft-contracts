<!DOCTYPE html><html lang="en">    <head>        <meta charset="utf-8" />        <!--            snippet has to:            - take dna from location query or generate a random dna            - export random(a,b) and noise() functions which are made from PRNG dnaed with dna            - when preview() is called, tell renderer outside iframe that render has finished         -->        <script id="hash-snippet">            ;(() => {                let dna = new URLSearchParams(window.location.search).get("dna")                if (!dna) {                    // example: 0xde4b0d963091d3b0a9c9604784c0d9df49e4261df639643cc07185e78bb930ab                    // random 64 chars of abcd...1234 in hex                    dna =                        "0x" +                        Array(64)                            .fill(0)                            .map(                                (_) =>                                    "0123456789abcdef"[                                        (Math.random() * 16) | 0                                    ],                            )                            .join("")                }                window.dna = dna                const Artgene = {} // namespace                // shuffling images, seed from DNA string                // https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript                function xmur3(str) {                    for (                        var i = 0, h = 1779033703 ^ str.length;                        i < str.length;                        i++                    ) {                        h = Math.imul(h ^ str.charCodeAt(i), 3432918353)                        h = (h << 13) | (h >>> 19)                    }                    return function () {                        h = Math.imul(h ^ (h >>> 16), 2246822507)                        h = Math.imul(h ^ (h >>> 13), 3266489909)                        return (h ^= h >>> 16) >>> 0                    }                }                function sfc32(a, b, c, d) {                    return function () {                        a |= 0                        b |= 0                        c |= 0                        d |= 0                        var t = (((a + b) | 0) + d) | 0                        d = (d + 1) | 0                        a = b ^ (b >>> 9)                        b = (c + (c << 3)) | 0                        c = (c << 21) | (c >>> 11)                        c = (c + t) | 0                        return (t >>> 0) / 4294967296                    }                }                const hash = xmur3(dna)                console.log("USING DNA:", dna, ", HASH:", hash())                // Pad seed with Phi, Pi and E.                // https://en.wikipedia.org/wiki/Nothing-up-my-sleeve_number                const _rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, hash())                window.rendered = false                const preview = () => {                    console.log("TRIGGER PREVIEW")                    window.rendered = true                }                // rand(a) should return [0,a]; rand(a,b) should return [a,b]                window.rand = (a, b) => {                    if (a === undefined) {                        return _rand()                    } else if (b === undefined) {                        return _rand() * a                    } else {                        return _rand() * (b - a) + a                    }                }                window.preview = preview                // for compatibility                window.fxrand = rand                window.fxpreview = preview                window.genome = []                const evolve = (name, value) => {                    const genome = window.genome                    const gene = genome.find((g) => g.name === name)                    if (!gene) {                        genome.push({ name, value })                    } else {                        gene.value = value                    }                    return { name, value }                }                Artgene.evolve = evolve                Artgene.rand = rand                Artgene.preview = preview                Artgene.genome = window.genome                window.Artgene = Artgene            })(window)        </script>        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>        <meta name="viewport" content="width=device-width, initial-scale=1" />        <title>artgene.xyz</title>        <style>            html,            body {                margin: 0;                padding: 0;            }            main {                background-color: #dedede;                width: 100vw;                height: 100vh;                display: flex;            }            canvas {                display: block;                margin: auto;                max-width: 100%;                max-height: 100%;                object-fit: contain;            }        </style>    </head>    <body>        <main></main>        <script id="#user-script">            // example script            function setup() {                createCanvas(600, 600)                background(30)                colorMode(HSB, 360, 100, 100, 100)                strokeWeight(3)                noLoop()                const seed = Math.floor(rand() * 10000)                noiseSeed(seed)            }            function draw() {                let step = 20                let noiseStep = 0.03                // Vertical lines                for (let x = 0; x < width; x += step) {                    let y1 = rand() * (height + step) - step                    let y2 = height                    let x1 = x + (rand() * step) / 2 - step / 4                    let x2 = x + (rand() * step) / 2 - step / 4                    x1 +=                        noise(x1 * noiseStep, frameCount * noiseStep) * 20 - 10                    x2 +=                        noise(x2 * noiseStep, frameCount * noiseStep) * 20 - 10                    let c = color(rand() * 360, 80, 90)                    stroke(c)                    line(x1, y1, x2, y2)                }                // Horizontal lines                for (let y = 0; y < height; y += step) {                    let x1 = rand() * (width + step) - step                    let x2 = width                    let y1 = y + (rand() * step) / 2 - step / 4                    let y2 = y + (rand() * step) / 2 - step / 4                    y1 +=                        noise(frameCount * noiseStep, y1 * noiseStep) * 20 - 10                    y2 +=                        noise(frameCount * noiseStep, y2 * noiseStep) * 20 - 10                    let c = color(rand() * 360, 80, 90)                    stroke(c)                    line(x1, y1, x2, y2)                }                preview()             }        </script>        <!-- if opened in iframe, needs to be centered -->        <script id="#resize-canvas">            function resizeCanvasIFrame() {                if (window.location === window.parent.location) {                    return                }                console.log("iframe detected", document)                const canvas = document.querySelector("canvas")                if (!canvas) {                    console.warn("No canvas found")                    return                }                const isPortraitRatio = canvas.style.width < canvas.style.height                canvas.style.height = isPortraitRatio ? "100%" : "auto"                canvas.style.width = isPortraitRatio ? "auto" : "100%"            }            window.addEventListener("load", resizeCanvasIFrame)            window.addEventListener("resize", resizeCanvasIFrame)        </script>    </body></html>